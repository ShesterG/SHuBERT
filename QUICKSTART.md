## Installation

### Quickstart: From raw videos to SHuBERT features
Assume the raw videos are stored under `./raw_vids/`

#### Step 1: Signer crop-out 
First, crop out the signer in the raw videos. We'll need yolov8 ckpt. You can download it from [here](https://huggingface.co/Ultralytics/YOLOv8/blob/main/yolov8n.pt). Make sure you have changed the `SBATCH` flags, `CONDA_ROOT`, `env_name` etc. before running it.
```bash
conda env create -f environment_feature_extraction.yml
conda activate feature_extraction
cd dataset
python ../write_list.py #input_files_list: raw video files
bash clips_crop.sh
```
- `--files_list`: .list file generated by write_list.py
- `--problem_file_path`: path to the failure logging file

-----------------
#### Step 2: Pose detection
Now, obtain poses from the cropped video. You'll need Mediapipe face landmarker and hand landmarker.
```bash
python ../write_list.py #input_files_list: crop-out video files 
bash kpe_mediapipe.sh #Change the paths to your own paths
```
- `--pose_path`: output folder
- `--stats_path`: path to store the stats of the poses (not important)
- `--files_list`: .list file generated by write_list.py
- `--problem_file_path`: path to the failure logging file
-----------------
#### Step 3: Face and hands crop-out
Obtain cropped face videos.
```bash
bash crop_face.sh 
```
- `--files_list`: .list file of the **cropped vidoes**. The same file you used for **step 2**
- `--problem_file_path`: path to the failure logging file
- `--pose_path`: path to the output folder in **step 2**
- `--face_path`: output folder


Same for hands
```bash
bash crop_hands.sh 
```
------------------
#### Step 4: Extract body features

Extract body features:

```bash
cd ../features
python ../write_list.py #input_files_list: pose files obtained by step 2
bash body_features.sh
```
- `--files_list`: .list file of the pose files
- `--pose_features_path` output folder

We will use finetuned dinov2 models to extract face and hand features. You'll need to download them [here]()
```bash
python ../write_list.py #input_files_list: face crops
conda env create -f environment_dino.yml
conda activate dino
bash face_features.sh
```
- `--files_list`: .list file of the pose files
- `--dino_path` path to ckpt of the face dino

Same for hands
```bash
python ../write_list.py #input_files_list: hand crops
bash hands_features.sh
```

------------------
#### Step 5: Run SHuBERT
For downloading SHuBERT weights, see [Model Weights](README.md#2-model-weights) section in the main README.
```bash
cd ..
conda env create -f environment_shubert.yml
conda activate shubert_train_env
cd fairseq
pip install -e .
cd ../features
bash shubert_inference.sh
```
